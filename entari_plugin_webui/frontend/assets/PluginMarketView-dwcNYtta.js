import{a as A,i as r,c as x,J as K,e as _,o as u,s,k as o,y as W,l as i,z as X,aP as Y,g as Z,Q as n,aQ as ee,aR as c,E as ae,F as C,A as V,H as te,G as w,t as v,m as ne,p,q as le,ah as B,f as se,aU as oe,C as h,I as ie}from"./index-D813liDI.js";import{d as I,a as re,E as ue,p as ce,i as de,u as me}from"./purify.es-Iq2qjZSd.js";import{E as ve}from"./el-card-GE_AQLmi.js";const fe={class:"plugin-market"},ge={class:"header"},_e={class:"card-header"},pe={class:"title-text"},he={class:"desc"},ye={class:"tags"},be={class:"bottom-info"},ke={class:"actions"},Ee=A({__name:"PluginMarketView",setup(xe){I.setOptions({async:!1});function P(e){return e?typeof e=="string"?e.trim()||"-":Array.isArray(e)?e.map(a=>typeof a=="string"?a:`${a.name||""} <${a.email||""}>`.trim()).join(" , "):`${e.name||""} <${e.email||""}>`.trim()||"-":"-"}function N(e){const a=e.meta==null||e.meta==="None"?void 0:e.meta;return a&&typeof a=="object"?{name:a.name??e.name,version:a.version??e.version??"-",author:P(a.author??a.authors),license:a.license??"-",description:a.description??e.desc??"-",homepage:e?.homepage??"",depend_services:Array.isArray(a.depend_services)?a.depend_services:[],readme:a.readme??""}:{name:e.name,version:e.version??"-",author:P(e.author),license:"-",description:e.desc??"-",homepage:e?.homepage??"",depend_services:[],readme:""}}const $=A({name:"PluginDetailDialog",props:{visible:{type:Boolean,default:!1},info:{type:Object,default:()=>({})}},emits:["update:visible"],setup(e,{emit:a}){const l=x({get:()=>e.visible,set:g=>a("update:visible",g)});return()=>n(ae,{modelValue:l.value,"onUpdate:modelValue":g=>l.value=g,title:"插件详情",width:800},()=>n(ee,{column:1,border:!0},()=>[n(c,{label:"名称"},()=>e.info.name),n(c,{label:"版本"},()=>e.info.version),n(c,{label:"作者"},()=>e.info.author),n(c,{label:"许可证"},()=>e.info.license),n(c,{label:"描述"},()=>e.info.description),n(c,{label:"详细内容",span:2},()=>e.info.readme?n("div",{class:"readme-box",innerHTML:ce.sanitize(I.parse(e.info.readme))}):"-"),n(c,{label:"依赖服务"},()=>e.info.depend_services.length?e.info.depend_services.join(" , "):"-")]))}}),z=r([]),y=r(""),f=r(""),j=["全部","推荐","媒体","统计","游戏","工具","实用"],D=x(()=>z.value.filter(e=>e.name.toLowerCase().includes(y.value.toLowerCase())&&(f.value==="全部"||f.value===""||e.tags.includes(f.value)))),b=r(6),k=r(1),L=x(()=>{const e=(k.value-1)*b.value;return D.value.slice(e,e+b.value)}),d=r(new Set),E=r(!1),M=r({});function O(e){M.value=N(e),E.value=!0}async function T(e){d.value.add(e.name);try{await de(e.name),e.installed=!0,h.success("安装成功")}catch(a){const l=a instanceof Error?a.message:String(a);h.error(l||"安装失败")}finally{d.value.delete(e.name)}}async function F(e){d.value.add(e.name);try{await me(e.name),e.installed=!1,h.success("卸载成功")}catch(a){const l=a instanceof Error?a.message:String(a);h.error(l||"卸载失败")}finally{d.value.delete(e.name)}}function H(e,a){e.target.closest(".el-button, .el-tag")||a.homepage&&window.open(a.homepage,"_blank","noopener")}return K(async()=>{z.value=await re()}),(e,a)=>{const l=W,g=te,Q=X,S=ne,U=le,R=ve,q=oe,G=Y,J=ue;return u(),_("div",fe,[s("div",ge,[o(l,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),placeholder:"Search","prefix-icon":"Search",style:{width:"260px"}},null,8,["modelValue"]),o(Q,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=t=>f.value=t),placeholder:"标签",style:{width:"120px","margin-left":"12px"}},{default:i(()=>[(u(),_(C,null,V(j,t=>o(g,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),o(G,{gutter:20,class:"list"},{default:i(()=>[(u(!0),_(C,null,V(L.value,t=>(u(),w(q,{key:t.name,xs:24,sm:12,md:8,style:{"margin-bottom":"20px"}},{default:i(()=>[o(R,{shadow:"hover",class:"plugin-card",onClick:m=>H(m,t)},{header:i(()=>[s("div",_e,[s("span",pe,v(t.fullName),1),t.installed?(u(),w(S,{key:0,size:"small",type:"success"},{default:i(()=>a[4]||(a[4]=[p("已安装")])),_:1,__:[4]})):se("",!0),o(U,{size:"small",text:"",onClick:B(m=>O(t),["stop"])},{default:i(()=>a[5]||(a[5]=[p("详情")])),_:2,__:[5]},1032,["onClick"])])]),default:i(()=>[s("p",he,v(t.desc),1),s("div",ye,[(u(!0),_(C,null,V(t.tags,m=>(u(),w(S,{key:m},{default:i(()=>[p(v(m),1)]),_:2},1024))),128))]),s("div",be,[s("span",null,"@"+v(t.author),1),s("span",null,"v"+v(t.version),1)]),s("div",ke,[o(U,{size:"small",type:t.installed?"danger":"primary",disabled:d.value.has(t.name),loading:d.value.has(t.name),onClick:B(m=>t.installed?F(t):T(t),["stop"])},{default:i(()=>[p(v(t.installed?"卸载":"安装"),1)]),_:2},1032,["type","disabled","loading","onClick"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),o(J,{"current-page":k.value,"onUpdate:currentPage":a[2]||(a[2]=t=>k.value=t),"page-size":b.value,total:D.value.length,layout:"prev, pager, next",style:{"justify-content":"center","margin-top":"20px"}},null,8,["current-page","page-size","total"]),o(Z($),{visible:E.value,"onUpdate:visible":a[3]||(a[3]=t=>E.value=t),info:M.value},null,8,["visible","info"])])}}}),Pe=ie(Ee,[["__scopeId","data-v-89545998"]]);export{Pe as default};
